# hash:sha256:fcd0785b3a5093d40a375c16ce20f776406784322cccc06fc0ae10b016f9c3bb
FROM registry.codeocean.allenneuraldynamics.org/codeocean/jupyterlab:3.6.1-miniconda4.12.0-python3.9-ubuntu20.04

ARG DEBIAN_FRONTEND=noninteractive
ARG API_KEY
ARG API_SECRET
ARG AWS_ACCESS_KEY_ID
ARG AWS_DEFAULT_REGION
ARG AWS_SECRET_ACCESS_KEY

ARG GIT_ASKPASS
ARG GIT_ACCESS_TOKEN
COPY git-askpass /

RUN apt-get update \
    && apt-get install -y --no-install-recommends \
        apt=2.0.5 \
        base-passwd=3.5.47 \
        bash=5.0-6ubuntu1.1 \
        bsdutils=1:2.34-0.1ubuntu9.1 \
        build-essential=12.8ubuntu1.1 \
        ca-certificates=20210119~20.04.1 \
        coreutils=8.30-3ubuntu2 \
        curl=7.68.0-1ubuntu2.5 \
        dash=0.5.10.2-6 \
        debconf=1.5.73 \
        diffutils=1:3.7-3 \
        e2fsprogs=1.45.5-2ubuntu1 \
        fdisk=2.34-0.1ubuntu9.1 \
        findutils=4.7.0-1ubuntu1 \
        git=1:2.25.1-1ubuntu3.1 \
        gnupg2=2.2.19-3ubuntu2.1 \
        grep=3.4-1 \
        gzip=1.10-0ubuntu4 \
        hostname=3.23 \
        less=551-1ubuntu0.1 \
        libacl1=2.2.53-6 \
        libattr1=1:2.4.48-5 \
        libext2fs2=1.45.5-2ubuntu1 \
        libpam-modules-bin=1.3.1-5ubuntu4.1 \
        libpam-runtime=1.3.1-5ubuntu4.1 \
        libpcre3=2:8.39-12build1 \
        libss2=1.45.5-2ubuntu1 \
        locales=2.31-0ubuntu9.2 \
        mawk=1.3.4.20200120-2 \
        mount=2.34-0.1ubuntu9.1 \
        nano=4.8-1ubuntu1 \
        ncurses-base=6.2-0ubuntu2 \
        ncurses-bin=6.2-0ubuntu2 \
        procps=2:3.3.16-1ubuntu2.1 \
        sed=4.7-1 \
        sensible-utils=0.0.12+nmu1 \
        sysvinit-utils=2.96-2.1ubuntu1 \
        unzip=6.0-25ubuntu1 \
    && rm -rf /var/lib/apt/lists/*

RUN conda install -y \
        jupyter==1.0.0 \
    && conda clean -ya

RUN pip3 install -U --no-cache-dir \
    setuptools==68.2.2
RUN pip3 install -U --no-cache-dir \
    aind-codeocean-api==0.2.5 \
    aiobotocore==2.5.4 \
    aiohttp==3.8.5 \
    aioitertools==0.11.0 \
    aiosignal==1.3.1 \
    appdirs==1.4.4 \
    asciitree==0.3.3 \
    asttokens==2.4.0 \
    async-timeout==4.0.3 \
    attrs==23.1.0 \
    backcall==0.2.0 \
    bidsschematools==0.7.2 \
    black==23.9.1 \
    blessed==1.20.0 \
    blosc2==2.0.0 \
    boto3==1.28.17 \
    botocore==1.31.17 \
    bottleneck==1.3.7 \
    bqplot==0.12.40 \
    certifi==2023.7.22 \
    cffi==1.16.0 \
    charset-normalizer==3.2.0 \
    ci-info==0.3.0 \
    click==8.1.7 \
    click-didyoumean==0.3.0 \
    cloudpickle==2.2.1 \
    comm==0.1.4 \
    contourpy==1.1.0 \
    coverage==7.3.1 \
    crc32c==2.3.post0 \
    cryptography==41.0.4 \
    cycler==0.12.0 \
    cython==3.0.2 \
    dandi==0.56.2 \
    dandischema==0.8.4 \
    debugpy==1.8.0 \
    decorator==5.1.1 \
    defusedxml==0.7.1 \
    dnspython==2.4.2 \
    dynamicroutingtask==0.1.17 \
    email-validator==2.0.0.post2 \
    entrypoints==0.4 \
    et-xmlfile==1.1.0 \
    etelemetry==0.3.0 \
    exceptiongroup==1.1.3 \
    execnet==2.0.2 \
    executing==1.2.0 \
    fasteners==0.19 \
    fonttools==4.42.1 \
    frozenlist==1.4.0 \
    fscacher==0.4.0 \
    fsspec==2023.9.2 \
    gast==0.4.0 \
    h5py==3.9.0 \
    hdmf==3.5.4 \
    hdmf-zarr==0.3.0 \
    humanize==4.8.0 \
    idna==3.4 \
    imageio==2.31.4 \
    importlib-metadata==4.13.0 \
    importlib-resources==6.1.0 \
    iniconfig==2.0.0 \
    interleave==0.2.1 \
    ipydatagrid==1.2.0 \
    ipydatawidgets==4.3.2 \
    ipyfilechooser==0.6.0 \
    ipykernel==6.25.2 \
    ipympl==0.9.3 \
    ipython==8.15.0 \
    ipython-genutils==0.2.0 \
    ipyvolume==0.6.3 \
    ipyvue==1.10.1 \
    ipyvuetify==1.8.10 \
    ipywebrtc==0.6.0 \
    ipywidgets==8.1.1 \
    isodate==0.6.1 \
    jaraco-classes==3.3.0 \
    jedi==0.19.0 \
    jeepney==0.8.0 \
    jmespath==1.0.1 \
    joblib==1.3.2 \
    jsonschema==4.19.1 \
    jsonschema-specifications==2023.7.1 \
    jupyter-client==8.3.1 \
    jupyter-core==5.3.2 \
    jupyterlab-widgets==3.0.9 \
    keyring==24.2.0 \
    keyrings-alt==5.0.0 \
    kiwisolver==1.4.5 \
    lazy-loader==0.3 \
    llvmlite==0.41.0 \
    loky==3.4.1 \
    markdown-it-py==3.0.0 \
    matplotlib==3.8.0 \
    matplotlib-inline==0.1.6 \
    mdurl==0.1.2 \
    more-itertools==10.1.0 \
    msgpack==1.0.7 \
    multidict==6.0.4 \
    mypy==1.5.1 \
    mypy-extensions==1.0.0 \
    natsort==8.4.0 \
    ndx-events==0.2.0 \
    ndx-grayscalevolume==0.0.2 \
    ndx-icephys-meta==0.1.0 \
    ndx-spectrum==0.2.2 \
    neo==0.12.0 \
    nest-asyncio==1.5.8 \
    networkx==3.1 \
    npc-lims==0.1.74 \
    npc-session==0.1.22 \
    npc-sessions==0.0.77 \
    numba==0.58.0 \
    numcodecs==0.11.0 \
    numexpr==2.8.7 \
    numpy==1.23.5 \
    nwbinspector==0.4.30 \
    nwbwidgets==0.11.3 \
    odfpy==1.4.1 \
    opencv-python-headless==4.8.1.78 \
    openpyxl==3.1.2 \
    packaging==23.1 \
    pandas==2.1.0 \
    parso==0.8.3 \
    pathspec==0.11.2 \
    pexpect==4.8.0 \
    pickleshare==0.7.5 \
    pillow==10.0.1 \
    platformdirs==3.10.0 \
    plotly==5.13.1 \
    pluggy==1.3.0 \
    polars==0.19.3 \
    probeinterface==0.2.17 \
    prompt-toolkit==3.0.39 \
    psutil==5.9.5 \
    ptyprocess==0.7.0 \
    pure-eval==0.2.2 \
    py-cpuinfo==9.0.0 \
    py2vega==0.6.1 \
    pyarrow==13.0.0 \
    pycparser==2.21 \
    pycryptodomex==3.19.0 \
    pydantic==1.10.13 \
    pydbhub-bjh==0.0.9 \
    pygments==2.16.1 \
    pynwb==2.3.3 \
    pyopenssl==23.2.0 \
    pyout==0.7.3 \
    pyparsing==3.1.1 \
    pytest==7.4.2 \
    pytest-cov==4.1.0 \
    pytest-xdist==3.3.1 \
    python-dateutil==2.8.2 \
    python-dotenv==1.0.0 \
    pythreejs==2.4.2 \
    pytz==2023.3.post1 \
    pywavelets==1.4.1 \
    pyxlsb==1.0.10 \
    pyyaml==6.0.1 \
    pyzmq==25.1.1 \
    quantities==0.14.1 \
    redis==5.0.1 \
    referencing==0.30.2 \
    requests==2.31.0 \
    rich==13.6.0 \
    rpds-py==0.10.3 \
    ruamel-yaml==0.17.33 \
    ruamel-yaml-clib==0.2.7 \
    ruff==0.0.291 \
    s3fs==2023.9.2 \
    s3transfer==0.6.2 \
    scikit-image==0.21.0 \
    scipy==1.9.3 \
    secretstorage==3.3.3 \
    semantic-version==2.10.0 \
    simpleitk==2.3.0 \
    six==1.16.0 \
    spikeinterface==0.98.2 \
    stack-data==0.6.2 \
    tables==3.8.0 \
    tenacity==8.2.3 \
    threadpoolctl==3.2.0 \
    tifffile==2023.9.26 \
    tomli==2.0.1 \
    tornado==6.3.3 \
    tqdm==4.66.1 \
    traitlets==5.10.1 \
    traittypes==0.2.1 \
    trimesh==3.23.5 \
    types-pyopenssl==23.2.0.2 \
    types-pyyaml==6.0.12.12 \
    types-redis==4.6.0.7 \
    typing-extensions==4.8.0 \
    tzdata==2023.3 \
    universal-pathlib==0.1.3 \
    urllib3==1.26.16 \
    wavpack-numcodecs==0.1.4 \
    wcwidth==0.2.7 \
    widgetsnbextension==4.0.9 \
    wrapt==1.15.0 \
    xlrd==2.0.1 \
    xlsxwriter==3.1.5 \
    yarl==1.9.2 \
    zarr==2.16.1 \
    zarr-checksum==0.2.9 \
    zipp==3.17.0
